# Providers must be at root level (before any sections)
providers = ["node", "python"]

[variables]
NODE_ENV = "production"
PYTHONUNBUFFERED = "1"

[phases.setup]
nixPkgs = ["nodejs_20", "python39"]

[phases.install]
# Install frontend and backend dependencies
# Each command runs from project root
cmds = [
  "npm ci --prefix ./frontend",
  "pip install --requirement ./backend/requirements.txt"
]

[phases.build]
# Build frontend and copy static files to backend
cmds = [
  "npm run build --prefix ./frontend",
  "mkdir --parents ./backend/static",
  "cp --recursive ./frontend/dist/* ./backend/static/"
]

[start]
cmd = "cd ./backend && python -m uvicorn app.main:app --host 0.0.0.0 --port $PORT"
